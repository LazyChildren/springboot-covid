<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>China</title>
		<style>
		
		body 
		
		{
			background-color: rgba(21, 25, 101);
		    background-image:url(../static/images/bg4.png);
		}
		
		header {
			/* max-width: 1920px; */
			/* position: relative; */
			background: url('../static/images/head_bg.png') no-repeat top center;
			height: 80px;
			/* ğŸ”ºç¼©æ”¾æ¯”ä¾‹ 100% */
			background-size: 100% 100%;
		}
		header h1 {
			color: white;
			font-size: 28px;
			/* æ–‡å­—å±…ä¸­ */
			text-align: center;
			line-height: 66px;
			font-weight: 800;
		}

		.showTime {
			position: absolute;
			top: -8px;
			right: 20px;
			/* float: right; */
			text-align: center;
			line-height: 75px;
			color: rgba(255, 255, 255);
			font-size: 18px;
		}

		</style>
		<link rel="stylesheet" type="text/css" href="../static/css/config.css"></link>
		<script src="../static/js/echarts.min.js"></script>
		<script src="../static/js/jquery-3.4.1.min.js"></script>
		<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/china.js"></script>
		
	</head>
	
	<body>
		<header container>

			<h1>å›½å†…ç–«æƒ…æ•°æ®</h1>
			<div class="showTime" id="ST"></div>
		</header>
		<div id="chinamap" class="chinamap"></div>
		<div id="chinazhu" class="chinazhu"></div>


		<div id="cure" class="cure">
			
		
		</div>


		<div id="chart1" class="chart1"></div>
		<div id="chart2" class="chart2"></div>
		<div id="bottom" class="bottom"></div>
		<!-- <div id="buttonarea" class="buttonarea">
			 <center><a href="world.html" >å…¨çƒç–«æƒ…</a></center> 
			
		</div> -->
		<script>
		        // åˆå§‹åŒ–echartså®ä¾‹
		        var myEcharts = echarts.init(document.getElementById("chinamap"));
		        var option = {
		            title: {  //æ ‡é¢˜æ ·å¼
		                text: 'å›½å†…ç–«æƒ…ä¸€è§ˆ',
		                x: "center",
						top: '10%',
						textStyle:{
							color: 'white',
							fontSize: '25',
						}
		            },
					
		            tooltip: {
		                trigger: 'item',
		                formatter: '{a}<br/>{b} : {c} äºº',
		            },
					toolbox: {   //å·¥å…·ç®±
					
					  show: true,   //æ˜¯å¦æ˜¾ç¤º  é»˜è®¤ä¸ºtrue
					
					  feature: {
						  
						dataView: {    //æ•°æ®è§†å›¾
						   show: true,
						   readOnly: true    //æ˜¯å¦åªè¯»  é»˜è®¤ä¸ºfalse
						},
					
					   
						
					
						restore: {   //åˆ·æ–°
						  show: true,
						  title: 'æ¢å¤'
						  
						},
					
						saveAsImage: {  //ä¿å­˜å›¾ç‰‡
						  show: true,
						  type: 'jpg'   //å›¾ç‰‡çš„æ–‡ä»¶ç±»å‹
						}
					  }
					},
					
					  visualMap: {
					    min: 0,
					    max: 50,
						text:[">100","0"],
					    calculable: false,
					    realtime: false,
					    inRange: {
						  color: ["#e0f3f8", "#ffc7c7", "#d17a7a", "#b43c3c", "#951919"],
					    },
					    textStyle: {
					      color: "rgba(255,255,255,1)"
					    }
					  },
		    
		            series: [
		                {
		                    name: 'å½“å‰ç¡®è¯Šäººæ•°',
		                    type: 'map',
		                    mapType: 'china',
		                    roam: false,//æ˜¯å¦å¼€å¯é¼ æ ‡ç¼©æ”¾å’Œå¹³ç§»æ¼«æ¸¸
		                    itemStyle: {//åœ°å›¾åŒºåŸŸçš„å¤šè¾¹å½¢ å›¾å½¢æ ·å¼
		                        normal: {//æ˜¯å›¾å½¢åœ¨é»˜è®¤çŠ¶æ€ä¸‹çš„æ ·å¼
		                            label: {
		                                show: true,//æ˜¯å¦æ˜¾ç¤ºæ ‡ç­¾
		                                textStyle: {
		                                    color: "black"
		                                }
		                            }
		                        },
		                        zoom: 1.5,  //åœ°å›¾ç¼©æ”¾æ¯”ä¾‹,é»˜è®¤ä¸º1
		                        emphasis: {//æ˜¯å›¾å½¢åœ¨é«˜äº®çŠ¶æ€ä¸‹çš„æ ·å¼,æ¯”å¦‚åœ¨é¼ æ ‡æ‚¬æµ®æˆ–è€…å›¾ä¾‹è”åŠ¨é«˜äº®æ—¶
		                            label: {show: true}
		                        }
		                    },
		                    top: "10%",//ç»„ä»¶è·ç¦»å®¹å™¨çš„è·ç¦»
		                    data: [
		                       
		                    ]
		                }
						
						
		            ]
		        };
		        // ä½¿ç”¨åˆšæŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨ã€‚
		        myEcharts.setOption(option);
					var maps=[];
				var fillToPieMap = function(epidemics){
				
					$.each(epidemics,function(index,epidemic){
						var obj={}
						obj.name=epidemic.name
						obj.value=epidemic.curnum
		
						maps.push(obj)
					});
					var obj={}
					obj.name="å—æµ·è¯¸å²›"
					obj.value=0
					maps.push(obj)

					
				};
				$.get("http://120.46.154.76:80/getmap",{},function(data){
		
					fillToPieMap(data);
				myEcharts.setOption(
				{
					
					series: [	
					{
						data:maps,
				    }]
				});
					
				})
				
		    </script>
			<script type="text/javascript">
				
				
			  // åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹
			  var myChart = echarts.init(document.getElementById('chinazhu'));
			 
			  
			  // æŒ‡å®šå›¾è¡¨çš„é…ç½®é¡¹å’Œæ•°æ®
			 var option = {
				 textStyle:
				 {
					 color:'#4b7fc3',
					 fontSize:'13',
				 },
				
			 				title: {  //æ ‡é¢˜æ ·å¼
			      text: 'è¿‘æ—¥å›½å†…ç–«æƒ…è¶‹åŠ¿',
			      left:'3%',
			  	top: '5%',
			  	textStyle:{
			  		color: 'white',
			  		fontSize: '15',
					fontWeight: 'lighter',
			  	}
			  },
			  dataZoom: [
			      {
			        type: 'inside',
			        start: 0,
			        end: 10
			      },
			      {
			        start: 0,
			        end: 10
			      }
			    ],
			  grid:{
				  top:'25%',
				  left: '15%',
				  right: '15%', 
				  bottom:'20%',
			  },
			  toolbox: {   //å·¥å…·ç®±
			  
			  show: true,   //æ˜¯å¦æ˜¾ç¤º  é»˜è®¤ä¸ºtrue
			
			  feature: {
				  
				dataView: {    //æ•°æ®è§†å›¾
				   show: true,
				   readOnly: true    //æ˜¯å¦åªè¯»  é»˜è®¤ä¸ºfalse
				},
			
			   magicType: {   //å›¾è¡¨åˆ‡æ¢
				  show: true,
				  type: ['line', 'bar']    //å¯ä»¥åˆ‡æ¢çš„å›¾è¡¨ç±»å‹çš„æ•°ç»„
			   },
				
			
				restore: {   //åˆ·æ–°
				  show: true,
				  title: 'æ¢å¤'
				  
				},
			
				saveAsImage: {  //ä¿å­˜å›¾ç‰‡
				  show: true,
				  type: 'jpg'   //å›¾ç‰‡çš„æ–‡ä»¶ç±»å‹
				}
			  }
			},
			    tooltip: {
			       trigger: 'axis',
			       position: function (pt) {
			         return [pt[0], '10%'];
			       }
			     },
			   
			   legend: {
			   				   top:'5%',
							   textStyle:
							   				 {
							   					 color:'#4b7fc3',
							   					 fontSize:'13',
							   				 },
			     data: ['ç´¯è®¡ç¡®è¯Š', 'æ–°å¢ç¡®è¯Š'],
			   },
			 
			   xAxis:{
				   
			   },
			   yAxis: [{
			 					type:'value',
			 					name:'æ–°å¢ç¡®è¯Š',
								alignTicks: true,
								boundaryGap: true,
								axisLine:
								{
										lineStyle:
										{
															color: '#4b7fc3',
										},
								},
								splitLine:
								{
									show:false,
									
								},
			 					textStyle:{
									color:'white',
								},
								
								
			 				},
			 				{
			 					type:'value',
			 					name:'ç´¯è®¡ç¡®è¯Š',
								alignTicks:true,
								boundaryGap: true,
								min: 'dataMin',
								axisLine:
								{
										lineStyle:
										{
															color: '#4b7fc3',
										},
								},
								
								splitLine:
								{
									show:false,
									
								},
								
			 				}],
			   series: [
			     {
			       name: 'ç´¯è®¡ç¡®è¯Š',
			       type: 'line',
			       data: [],
				   yAxisIndex: 1,
				   smooth: true,
				   showSymbol: false,
				   lineStyle:{
					   color:'rgb(0,230,0)',
					   
				   },
				   itemStyle:{
					 color:  'rgb(0,230,0)',
				   },
				   areaStyle: {
							color: {
								type: 'linear',
								x: 0,
								y: 0,
								x2: 0,
								y2: 1,
								colorStops: [
									{
										offset: 0,
										color: 'rgba(44,254,100,1)' // 0% å¤„çš„é¢œè‰²
									},
									{
										offset: 0.3,
										color: 'rgba(44,250,80,0.6)' // 
									},
									{
										offset: 0.7,
										color: 'rgba(30,250,50,0.2)' // 
									},
									{
										offset: 1,
										color: 'rgba(44,254,239,0)' // 
									}
								],
								global: false // ç¼ºçœä¸º false
							}
						}
			     },
				  {
					  name:'æ–°å¢ç¡®è¯Š',
					  type:'line',
					  data: [],
					  smooth: true,
					  showSymbol: false,
					  lineStyle:
					  {
										color: '#50c1c3',
					  },
					  itemStyle:{
						  color: '#50c1c3',
					  },
					  areaStyle: {
					  							color: {
					  								type: 'linear',
					  								x: 0,
					  								y: 0,
					  								x2: 0,
					  								y2: 1,
					  								colorStops: [
					  									{
					  										offset: 0,
					  										color: 'rgba(44,100,254,1.0' // 0% å¤„çš„é¢œè‰²
					  									},
					  									{
					  										offset: 0.3,
					  										color: 'rgba(44,254,239,0.6)' // 
					  									},
					  									{
					  										offset: 0.7,
					  										color: 'rgba(44,254,239,0.2)' // 
					  									},
					  									{
					  										offset: 1,
					  										color: 'rgba(44,254,239,0)' // 
					  									}
					  								],
					  								global: false // ç¼ºçœä¸º false
					  							}
					  						}
				  }
			   ]
			 };
			 			
			 // ä½¿ç”¨åˆšæŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨ã€‚
			 myChart.setOption(option);
			 
			 $.get("http://120.46.154.76:80/getdetail",function(data){
				 var newPa = [];
				 var date=[];
				 var totalPa=[];
				 var oneDay= 24*3600*1000;
			
				 var base =  +new Date();
				 $.each(data,function(index,cur){
					 var now = new Date(cur.year,cur.month,cur.date);
					  date.push([now.getFullYear(), now.getMonth(), now.getDate()].join('/'));
			
					 newPa.push(cur.newnum);
					  
					
					 totalPa.push(cur.totalnum);
				 })
				  myChart.setOption({
				  xAxis: {
							type:'category',
							data: date,
							boundaryGap : false,
							axisLine:
							{
									lineStyle:
									{
														color: '#4b7fc3',
									},
							},
							minorSplitLine:
							{
								lineStyle:
								{
													color: '#4b7fc3',
								},
							},
					  },
					  series:[{
						  name:'æ–°å¢ç¡®è¯Š',
						  data:newPa,
					  },{
						  name:'ç´¯è®¡ç¡®è¯Š',
						  data:totalPa,
					  }]
				  });
			 })
			</script>
			<script>
				  var myChart1 = echarts.init(document.getElementById('chart1'));
				  var option={
					  textStyle:
					  {
					  					 color:'#4b7fc3',
					  					 fontSize:'15',
					  },
					  tooltip:{   //å·¥å…·æç¤º
					     //show: false,   //æ˜¯å¦æ˜¾ç¤º  é»˜è®¤ä¸ºtrue
					     trigger: 'axis'   ,//æç¤ºæ¡†çš„è§¦å‘æ—¶æœº  axis: åæ ‡è½´è§¦å‘ æŸ±çŠ¶å›¾ï¼ŒæŠ˜çº¿å›¾   itemï¼šæ•°æ®é¡¹è§¦å‘ æ•£ç‚¹å›¾ï¼Œé¥¼å›¾
					  },
					 
					  
					title: {  //æ ‡é¢˜æ ·å¼
					    text: 'å„çœç´¯è®¡ç¡®è¯Šäººæ•°æ’å',
					  textStyle:{
					  	color: 'white',
					  	fontSize: '20',
					  	fontWeight: 'lighter',
					  },
					 },
						 xAxis:{
							 name:'ç¡®è¯Šäººæ•°',
							type:'log',
							splitLine:
							{
								show:false,
								
							},
							axisLine:
							{
									lineStyle:
									{
														color: '#4b7fc3',
									},
							},
							
						 },
						 yAxis:{
							 name:'çœä»½(å«è‡ªæ²»åŒºç›´è¾–å¸‚ç­‰)',
							 type:'category',
							data:[],
							axisLine:
							{
									lineStyle:
									{
														color: '#4b7fc3',
									},
							},
						 },
						 series: {
						      type: 'bar',
						      name:'ç´¯è®¡ç¡®è¯Šäººæ•°',
							  data:[],
						  itemStyle: {
								color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
								  { offset: 0, color: '#83bff6' },
								  { offset: 0.5, color: '#188df0' },
								  { offset: 1, color: '#188df0' }
								])
							  },
						   }
				  };
				  myChart1.setOption(option);
				  $.get("http://120.46.154.76:80/getmap",function(data){
					  var names=[];
					  var confirms=[];
					  $.each(data,function(index,cur){
						  names[index]=cur.name;
						  confirms[index]=cur.sumnum;
					  })
					  myChart1.setOption({
						  yAxis:{
							  data:names,
						  },
						  series:{
							  data:confirms,
						  },
					  })
				  })
			</script>
			<script>
				 var myChart2 = echarts.init(document.getElementById('chart2'));
				 var option={
					 textStyle:
					 {
					 					 color:'#4b7fc3',
					 					 fontSize:'15',
					 },
					 title:{
						 text:'å›½å†…æ‚£ç—…æƒ…å†µ',
						 textStyle:{
						 	color: 'white',
						 
						 	fontWeight: 'lighter',
						 },
					 },
					 legend:{
						left:'10%',
						 top:'10%',
						 textStyle:{
							 color:'#4b7fc3',
						 },
					 },
					tooltip:{
					   trigger: 'item',   //æ•°æ®é¡¹è§¦å‘
					   formatter: '{a}<br/>{b} : {c} ({d}%)'   //æ•°æ®æ ¼å¼   a åºåˆ—åç§°   b æ•°æ®åç§°  c æ•°å€¼  d ç™¾åˆ†æ¯”
					},
					
					series: [
					   {
					     name: 'æ‚£è€…æƒ…å†µ',
					     type: 'pie',   //é¥¼å›¾
						  avoidLabelOverlap: true,
					     //radius: '50%',   //åŠå¾„   ç™¾åˆ†æ¯” = min(width, height) / 2 * 50%  ä¼ å…¥æ•°ç»„è¡¨ç¤ºç¯å½¢å›¾
						 radius: ['30%', '50%'],   //åŠå¾„   ä¼ å…¥æ•°ç»„è¡¨ç¤ºç¯å½¢å›¾
					     
						 center: ['50%', '50%'],   //åœ†å¿ƒåæ ‡  pxæˆ–ç™¾åˆ†æ¯” = min(width, height) * 50%
						 labelLine:{
							 length:5,
							 length2:5,
						 },
					     itemStyle:{
					        normal : {
					          label: {
					            show: true,
					            formatter: '{b}: {c} ({d}%)'   //{a}ï¼šç³»åˆ—åã€‚ {b}ï¼šæ•°æ®åã€‚{c}ï¼šæ•°æ®å€¼ã€‚ {d}ï¼šç™¾åˆ†æ¯”ã€‚
					          }
					        }
					     },
					
					    data: [],
					  }
					],
					
				 }
				 myChart2.setOption(option);
				 $.get("http://120.46.154.76:80/getpatient",function(data){
					 var patients=[]
					 $.each(data,function(index,cur){
					 	var obj={}
					 	obj.name=cur.situation
					 	obj.value=cur.num
					 		
					 	patients.push(obj)
					 });
					 console.log(patients)
					 myChart2.setOption({
						 series:{
							 data:patients,
						 }
					 })
				 })

				 let formaDate = function () {
					let d = new Date();
					let year = d.getFullYear(), //å¤šå˜é‡èµ‹å€¼
						month = d.getMonth() + 1, //monthï¼šä»0å¼€å§‹
						date = d.getDate(),
						hour = d.getHours(),
						minute = d.getMinutes(),
						second = d.getSeconds();

					year = year < 10 ? '0' + year : year; //ä¸‰å…ƒæ“ä½œç¬¦
					month = month < 10 ? '0' + month : month;
					date = date < 10 ? '0' + date : date;
					hour = hour < 10 ? '0' + hour : hour;
					minute = minute < 10 ? '0' + minute : minute;
					second = second < 10 ? '0' + second : second;
					let a = year + '-' + month + '-' + date + ' ' + hour + ':' + minute + ':' + second;
					$('.showTime').html('<p>' + a + '</p>');
					window.addEventListener('resize', () => {
						let w = document.documentElement.clientWidth;
						let ST = document.getElementById('ST');
						if (w < 720) {
						ST.style.display = 'none';
						} else {
						ST.style.display = 'block';
						}
					});
					};
					setInterval(formaDate, 1000); //è®¾å®šå®šæ—¶å™¨ï¼Œå¾ªç¯è¿è¡Œ;


			</script>
	</body>
</html>
